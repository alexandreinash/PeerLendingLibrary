spring.application.name=backend

# Database - Supabase PostgreSQL
# Uses environment variables if provided, otherwise defaults to Supabase
# SSL mode is required for Supabase connections
# Using TRANSACTION pooler (port 6543) - supports transactions unlike session pooler (port 5432)
# Transaction pooler allows proper commit/rollback operations
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://aws-1-ap-southeast-2.pooler.supabase.com:6543/postgres?sslmode=require}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres.ztetplqgjemxswqksnhm}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:Alexandrei.1626}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection pool settings for Supabase TRANSACTION pooler
# Transaction pooler supports transactions but works best with smaller pools
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
# Auto-commit managed by Hibernate for proper transactions
spring.datasource.hikari.auto-commit=false

# JPA/Hibernate settings for Supabase TRANSACTION pooler
# Transaction pooler supports full transaction management
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
# Use thread-local session context
spring.jpa.properties.hibernate.current_session_context_class=thread
# Transaction timeout
spring.transaction.default-timeout=60
# Use JDBC transaction coordinator
spring.jpa.properties.hibernate.transaction.coordinator_class=jdbc

# Hibernate - Delay schema update to speed up startup
spring.jpa.hibernate.ddl-auto=update
spring.jpa.open-in-view=false
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.hbm2ddl.auto=update
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
# Don't validate schema on startup (speeds up startup, validates on first use)
spring.jpa.properties.hibernate.hbm2ddl.jdbc_metadata_extraction_strategy=individually
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false

# Connection validation
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.validation-timeout=10000
spring.datasource.hikari.initialization-fail-timeout=60000

# Allow Hibernate to continue even if connection fails initially (will retry)
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false

# Server - Render sets PORT automatically via environment variable
server.port=${PORT:8080}

# JWT - Uses environment variables
app.jwt.secret=${APP_JWT_SECRET}
app.jwt.expiration-ms=${APP_JWT_EXPIRATION_MS:86400000}

# Swagger
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true

# Request size limits (for base64 image uploads)
spring.servlet.multipart.max-file-size=2MB
spring.servlet.multipart.max-request-size=2MB
server.tomcat.max-http-post-size=2MB

# Actuator for health checks - configured for fast response
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
# Disable database health check to prevent timeout
management.health.db.enabled=false
management.health.diskspace.enabled=false
management.health.ping.enabled=true
# Only enable ping health check (fastest)
management.health.defaults.enabled=false
# Health groups for fast response
management.endpoint.health.group.liveness.include=ping
management.endpoint.health.group.readiness.include=ping

